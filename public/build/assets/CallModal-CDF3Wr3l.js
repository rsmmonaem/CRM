import{m as y,u as D,y as j,B as z,g as o,o as n,b as e,t as d,i as u,f as T,k as h,x as I,d as s,F as N,p as V,e as P,s as w,n as C}from"./app-CLSGPmsT.js";const H={class:"fixed inset-0 z-50 overflow-y-auto"},J={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},K={class:"inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-6xl sm:w-full"},W={class:"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},G={class:"sm:flex sm:items-start mb-6"},Q={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full"},Y={class:"text-lg leading-6 font-medium text-gray-900 dark:text-white"},Z={class:"mt-2"},ee={class:"text-sm text-gray-500 dark:text-gray-400"},te={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ae={class:"space-y-4"},le={class:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600"},re={class:"flex items-center space-x-3"},se={class:"flex-1"},oe=["value"],ne=["disabled"],de={key:0,class:"mt-2 text-sm text-red-600 dark:text-red-400"},ie={class:"bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg p-4 border border-green-200 dark:border-green-600"},ce={key:0,class:"mb-4 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600"},ue={class:"flex items-center justify-between mb-2"},me={class:"text-lg font-mono font-bold text-green-600 dark:text-green-400"},ge={class:"text-xs text-gray-500 dark:text-gray-400"},pe={class:"flex flex-wrap gap-2"},xe=["disabled"],be={key:1,class:"mt-3 text-center"},fe={class:"ml-2 font-mono text-lg font-semibold text-gray-900 dark:text-white"},ye={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},_e={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},ke={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},he={class:"flex justify-end space-x-3 pt-4"},ve=["disabled"],we={class:"space-y-4"},Ce={key:0,class:"space-y-3"},Se={class:"flex justify-between items-start mb-2"},De={class:"flex items-center space-x-2"},je={class:"text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded"},Te={key:0,class:"text-xs font-medium text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-800 px-2 py-1 rounded"},Ne={class:"text-xs text-gray-500 dark:text-gray-400"},Ve={class:"text-sm text-gray-700 dark:text-gray-300 mb-2"},Me={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},Oe={key:1,class:"text-xs text-green-600 dark:text-green-400 mt-1"},Ae={key:2,class:"text-xs text-orange-600 dark:text-orange-400 mt-1"},Ee={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Ue={__name:"CallModal",props:{lead:Object,statuses:Array},emits:["close"],setup(b,{emit:M}){const i=b,_=M,g=y([]),p=y(null),x=y(!1),v=y(0),f=y(null),O=async a=>{if(a)try{const t=await fetch(`/api/leads/${a}/call-history-public`);if(t.ok){const l=await t.json();g.value=l.lead_details||[]}else g.value=[]}catch{g.value=[]}},r=D({lead_id:null,call_followup_date:new Date().toISOString().split("T")[0],call_followup_summary:"",next_call_date:""}),c=D({status_id:null});j(()=>i.lead,a=>{a&&a.id?(r.lead_id=a.id,c.status_id=a.status_id,a.lead_details&&a.lead_details.length>0?g.value=a.lead_details:O(a.id)):(g.value=[],c.status_id=null)},{immediate:!0}),j(()=>i.callDetail,a=>{a&&(r.call_followup_summary=a.call_followup_summary||"",r.next_call_date=a.next_call_date?new Date(a.next_call_date).toISOString().split("T")[0]:"")},{immediate:!0});const A=()=>{r.lead_id&&(i.callDetail?r.patch(route("lead-details.complete",i.callDetail.id),{onSuccess:()=>{_("close"),r.reset(),r.call_followup_date=new Date().toISOString().split("T")[0]},onError:a=>{}}):r.post(route("lead-details.store"),{onSuccess:()=>{_("close"),r.reset(),r.call_followup_date=new Date().toISOString().split("T")[0]},onError:a=>{}}))},E=()=>{!i.lead?.id||!c.status_id||c.put(route("leads.update",i.lead.id),{onSuccess:()=>{i.lead&&(i.lead.status_id=c.status_id)},onError:a=>{}})},q=async()=>{if(!i.lead?.id||!i.lead?.phone){alert("No phone number available for this lead");return}try{const a=await fetch("/api/call-trackings",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({lead_id:i.lead.id,phone_number:i.lead.phone,device_type:"web",is_auto_dialed:!0})});if(a.ok){const t=await a.json();p.value=t.call_tracking,x.value=!0,U(),await X(t.call_tracking);const m=`tel:${i.lead.phone.replace(/\D/g,"")}`,S=document.createElement("a");S.href=m,S.click(),k("ringing")}else{const t=await a.json();alert("Failed to initiate call tracking: "+(t.message||"Unknown error"))}}catch(a){console.error("Error initiating call:",a),alert("Failed to initiate call tracking")}},k=async(a,t=null)=>{if(p.value?.id)try{const l=await fetch(`/api/call-trackings/${p.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({call_status:a,call_summary:t})});if(l.ok){const m=await l.json();p.value=m.call_tracking,(a==="completed"||a==="cancelled")&&F()}}catch(l){console.error("Error updating call status:",l)}},U=()=>{v.value=0,f.value=setInterval(()=>{v.value++},1e3)},F=()=>{x.value=!1,f.value&&(clearInterval(f.value),f.value=null)},L=a=>{const t=Math.floor(a/3600),l=Math.floor(a%3600/60),m=a%60;return t>0?`${t.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`:`${l.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`},$=()=>{k("answered")},B=()=>{const a=prompt("Enter call summary:");a!==null&&k("completed",a)},R=()=>{k("cancelled")},X=async a=>{try{const t=await fetch("/api/call-notifications/notify",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({user_id:a.user_id,lead_id:a.lead_id,phone_number:i.lead.phone,call_id:a.call_id})});if(t.ok){const l=await t.json();console.log("Call notification sent to Android app:",l)}else console.error("Failed to send notification to Android app")}catch(t){console.error("Error sending notification to Android app:",t)}};return z(()=>{f.value&&clearInterval(f.value)}),(a,t)=>(n(),o("div",H,[e("div",J,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75",onClick:t[0]||(t[0]=l=>_("close"))}),e("div",K,[e("div",W,[e("div",G,[t[6]||(t[6]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})])],-1)),e("div",Q,[e("h3",Y,d(a.callDetail?"Complete Call":"Call Lead")+": "+d(b.lead?.name||"Loading..."),1),e("div",Z,[e("p",ee,d(b.lead?.company_name||"Loading...")+" • "+d(b.lead?.phone||"Loading...")+" • "+d(b.lead?.email||"Loading..."),1)])])]),e("div",te,[e("div",ae,[e("div",le,[t[8]||(t[8]=e("h4",{class:"text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center"},[e("svg",{class:"h-4 w-4 text-indigo-600 dark:text-indigo-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),T(" Update Lead Status ")],-1)),e("div",re,[e("div",se,[h(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>s(c).status_id=l),class:"w-full border-gray-300 dark:border-gray-600 dark:bg-gray-600 dark:text-white rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm"},[t[7]||(t[7]=e("option",{value:""},"Select Status",-1)),(n(!0),o(N,null,V(b.statuses,l=>(n(),o("option",{key:l.id,value:l.id},d(l.name),9,oe))),128))],512),[[I,s(c).status_id]])]),e("button",{type:"button",onClick:E,disabled:!s(c).status_id||s(c).processing,class:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},d(s(c).processing?"Updating...":"Update"),9,ne)]),s(c).errors.status_id?(n(),o("div",de,d(s(c).errors.status_id),1)):u("",!0)]),e("div",ie,[t[12]||(t[12]=e("h4",{class:"text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center"},[e("svg",{class:"h-4 w-4 text-green-600 dark:text-green-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})]),T(" Call Tracking ")],-1)),x.value?(n(),o("div",ce,[e("div",ue,[t[9]||(t[9]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Call in Progress",-1)),e("span",me,d(L(v.value)),1)]),e("div",ge," Status: "+d(p.value?.call_status||"Unknown"),1)])):u("",!0),e("div",pe,[x.value?u("",!0):(n(),o("button",{key:0,onClick:q,disabled:!i.lead?.phone,class:"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-all duration-200 flex items-center justify-center space-x-2"},[t[10]||(t[10]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1)),e("span",null,d(i.lead?.phone?"Auto-Dial":"No Phone Number"),1)],8,xe)),x.value&&p.value?.call_status==="ringing"?(n(),o("button",{key:1,onClick:$,class:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-all duration-200"}," Answer Call ")):u("",!0),x.value&&p.value?.call_status==="answered"?(n(),o("button",{key:2,onClick:B,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-all duration-200"}," Complete Call ")):u("",!0),x.value?(n(),o("button",{key:3,onClick:R,class:"flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-all duration-200"}," Cancel Call ")):u("",!0)]),i.lead?.phone?(n(),o("div",be,[t[11]||(t[11]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Calling:",-1)),e("span",fe,d(i.lead.phone),1)])):u("",!0)]),e("form",{onSubmit:P(A,["prevent"]),class:"space-y-4"},[e("div",null,[t[13]||(t[13]=e("label",{for:"call_followup_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Call Date * ",-1)),h(e("input",{type:"date",id:"call_followup_date","onUpdate:modelValue":t[2]||(t[2]=l=>s(r).call_followup_date=l),class:C(["mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":s(r).errors.call_followup_date}]),required:""},null,2),[[w,s(r).call_followup_date]]),s(r).errors.call_followup_date?(n(),o("div",ye,d(s(r).errors.call_followup_date),1)):u("",!0)]),e("div",null,[t[14]||(t[14]=e("label",{for:"call_followup_summary",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Call Summary * ",-1)),h(e("textarea",{id:"call_followup_summary","onUpdate:modelValue":t[3]||(t[3]=l=>s(r).call_followup_summary=l),rows:"4",class:C(["mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":s(r).errors.call_followup_summary}]),placeholder:"Enter call details and outcome...",required:""},null,2),[[w,s(r).call_followup_summary]]),s(r).errors.call_followup_summary?(n(),o("div",_e,d(s(r).errors.call_followup_summary),1)):u("",!0)]),e("div",null,[t[15]||(t[15]=e("label",{for:"next_call_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Next Call Date (Optional) ",-1)),h(e("input",{type:"date",id:"next_call_date","onUpdate:modelValue":t[4]||(t[4]=l=>s(r).next_call_date=l),class:"mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,512),[[w,s(r).next_call_date]]),s(r).errors.next_call_date?(n(),o("div",ke,d(s(r).errors.next_call_date),1)):u("",!0)]),e("div",he,[e("button",{type:"button",onClick:t[5]||(t[5]=l=>_("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," Cancel "),e("button",{type:"submit",disabled:s(r).processing,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},d(s(r).processing?"Saving...":a.callDetail?"Complete Call":"Save Call Details"),9,ve)])],32)]),e("div",we,[t[17]||(t[17]=e("h4",{class:"text-md font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-600 pb-2"}," Latest Call History ",-1)),g.value&&g.value.length>0?(n(),o("div",Ce,[(n(!0),o(N,null,V(g.value.slice(0,3),(l,m)=>(n(),o("div",{key:l.id,class:C(["border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900 border-blue-200 dark:border-blue-700":m===0}])},[e("div",Se,[e("div",De,[e("span",je," Call #"+d(g.value.length-m),1),m===0?(n(),o("span",Te," Latest ")):u("",!0)]),e("span",Ne,d(new Date(l.call_followup_date).toLocaleDateString()),1)]),e("p",Ve,d(l.call_followup_summary),1),l.next_call_date?(n(),o("div",Me," Next call: "+d(new Date(l.next_call_date).toLocaleDateString()),1)):u("",!0),l.called_at?(n(),o("div",Oe," ✓ Completed on "+d(new Date(l.called_at).toLocaleDateString()),1)):(n(),o("div",Ae," ⏳ Pending "))],2))),128))])):(n(),o("div",Ee,[...t[16]||(t[16]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1),e("p",{class:"mt-2 text-sm"},"No call history available",-1),e("p",{class:"text-xs text-gray-400 dark:text-gray-500"},"This will be the first call for this lead",-1)])]))])])])])])]))}};export{Ue as _};
